---
title: "Useful Data Preperation Functions"
output: 
  html_document:
   toc: true
   toc_depth: 2
   number_section: false
   self_contained: false
   highlight: textmate
---

##Create KNN features

The function *knn_creator* creates a knn predictor. 

It takes a matrix as argument (preferrably a PCA or other scale controlled matrix). 

Matrix is assumes to contain both labeled and non-labelled data (train and holdout). 

Argument *train_tot_flag* is a logical vector that identifies the training (labelled) rows. 

Argument *target_train_tot* provides the training labels associated with the training rows. 

```{r, echo=TRUE, eval=FALSE}

knn_creator<- function(data_tot_matrix, train_tot_flag, target_train_tot, k){
  
  knn_train_tot<- FNN::knn.reg(train = data_tot_matrix[train_tot_flag, ], test = data_tot_matrix[train_tot_flag, ], y = target_train_tot, k = k+1)$pred
  knn_train_tot<- (knn_train_tot*(k+1)-target_train_tot)/k
  
  knn_holdout<- FNN::knn.reg(train = data_tot_matrix[train_tot_flag, ], test = data_tot_matrix[!train_tot_flag, ], y = target_train_tot, k = k)$pred
  return(c(knn_train_tot, knn_holdout))
}

knn_10<- knn_creator(data_tot_matrix = data_tot_pca[, 1:21], train_tot_flag = train_tot_flag, target_train_tot = target_train_tot, k = 10)


```



##Create interactions

This function creates a one-hot encoded matrix from the interactions of the provided variables. 

```{r, echo=TRUE, eval=FALSE}
cross_creator<- function(v1, v2, bins){
  
  v1_bin<- cut(v1, breaks = quantile(v1, probs = 0:bins/bins), include.lowest = T, labels = F)
  v2_bin<- cut(v2, breaks = quantile(v2, probs = 0:bins/bins), include.lowest = T, labels = F)
  
  var_cross<- paste(v1_bin, v2_bin, sep="_")
  
  return(model.matrix(~.-1, data.frame(var_cross)))
}
```
